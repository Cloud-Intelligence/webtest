---
// UnlockScreen component
import UnlockSlider from './UnlockSlider.astro';
import Navbar from './Navbar.astro';
---

<!-- Unlock Screen -->
<div id="unlockScreen">
  <div class="animated-gradient-bg"></div>

  <!-- Logo -->
  <img src="/webtest/logo.png" class="lockscreen-logo" alt="CI Logo" />

  <!-- Slider Component -->
  <div class="slider-wrapper">
    <UnlockSlider />
  </div>
</div>

<!-- Hidden Navbar (will show after unlock) -->
<div id="navbar-container" style="display: none;">
  <Navbar />
</div>

<script>
  import { gsap } from 'gsap';

  // Animated gradient background
  document.addEventListener('DOMContentLoaded', () => {
    const gradientBg = document.querySelector('.animated-gradient-bg');
    
    if (gradientBg) {
      // Create moving gradient animation for all radial points
      gsap.to(gradientBg, {
        backgroundPosition: '400% 400%, 350% 350%, 300% 300%, 0% 0%',
        duration: 80,
        ease: 'none',
        repeat: -1,
        yoyo: true
      });
      
      // Create a second animation for counter-direction movement
      gsap.to(gradientBg, {
        backgroundPositionX: '400%, -50%, 150%, 0%',
        duration: 100,
        ease: 'none',
        repeat: -1,
        yoyo: true,
        delay: 10
      });
      
      // Third animation for the sky blue gradient (different timing)
      gsap.to(gradientBg, {
        backgroundPositionY: '200%, 400%, -100%, 0%',
        duration: 90,
        ease: 'none',
        repeat: -1,
        yoyo: true,
        delay: 20
      });
      
      // Add subtle scale animation
      gsap.to(gradientBg, {
        scale: 1.05,
        duration: 120,
        ease: 'power2.inOut',
        repeat: -1,
        yoyo: true
      });
    }
  });

  // Listen for unlock event
  document.addEventListener('slider-unlock', (event: CustomEvent) => {
    console.log('Slider unlocked!', event.detail);
    
    // Simple unlock animation
    const unlockScreen = document.getElementById('unlockScreen');
    const mainScreen = document.getElementById('mainScreen');
    const navbarContainer = document.getElementById('navbar-container');
    
    if (unlockScreen && mainScreen && navbarContainer) {
      // Fade out unlock screen
      unlockScreen.style.transition = 'opacity 0.5s ease-out';
      unlockScreen.style.opacity = '0';
      
      setTimeout(() => {
        unlockScreen.style.display = 'none';
        mainScreen.style.visibility = 'visible';
        mainScreen.style.opacity = '1';
        
        // Show navbar with fade-in effect
        navbarContainer.style.display = 'block';
        navbarContainer.style.opacity = '0';
        navbarContainer.style.transition = 'opacity 0.3s ease-in';
        
        // Delay navbar appearance slightly
        setTimeout(() => {
          navbarContainer.style.opacity = '1';
        }, 200);
      }, 500);
    }
  });
</script>

<style>
  .animated-gradient-bg {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    background: 
      radial-gradient(
        circle at 30% 40%,
        #387BF6 0%,
        #4B0082 20%,
        transparent 50%
      ),
      radial-gradient(
        circle at 70% 60%,
        #1e3a8a 0%,
        #312e81 30%,
        transparent 60%
      ),
      radial-gradient(
        circle at 50% 20%,
        #87CEEB 0%,
        #FFFFFF 25%,
        transparent 45%
      ),
      linear-gradient(
        45deg,
        #1e1b4b 0%,
        #312e81 50%,
        #4c1d95 100%
      );
    background-size: 400% 400%, 350% 350%, 300% 300%, 100% 100%;
    z-index: 1;
  }

  .lockscreen-logo {
    position: relative;
    z-index: 2;
  }

  .slider-wrapper {
    position: absolute;
    bottom: 20%;
    left: 50%;
    transform: translateX(-50%);
    z-index: 2;
  }
</style>